<?xml version="1.0" encoding="UTF-8"?>
<sequence name="PaymentRequestProcessingSequence" trace="disable" xmlns="http://ws.apache.org/ns/synapse">
    <call>
        <endpoint key="SettlePaymentEP"/>
    </call>
    <log description="" level="full"/>
    <property description="Get Payment Response" expression="json-eval($.)" name="payment_response" scope="default" type="STRING"/>
    <payloadFactory description="" media-type="json">
        <format>{
	"patient":$1,
	"actualFee":$2,
	"discount":$3,
	"discounted":$4,
	"status":"$5",
	"cancellation link" : "https://localhost:9445/bpmn-explorer/"
}</format>
        <args>
            <arg evaluator="json" expression="$.patient"/>
            <arg evaluator="json" expression="$.actualFee"/>
            <arg evaluator="json" expression="$.discount"/>
            <arg evaluator="json" expression="$.discounted"/>
            <arg evaluator="json" expression="$.status"/>
        </args>
    </payloadFactory>
    <property description="Get Payment Response" expression="json-eval($.)" name="payment_response" scope="default" type="STRING"/>
    <gmail.init>
        <userId>wso2com@gmail.com</userId>
        <accessToken>ya29.GlsVBOsCNGC6sBIzIWcbfRQyqeicjH_Cj1XphfIHoDUsY5d3GV2-T-HJBoSM58lTIvGdvZb4zqQVPUR5Q2Q-TfMCK-pHOa6TQo7LL3hQA-Zld7FNH_76Q745uG5p</accessToken>
        <apiUrl>https://www.googleapis.com/gmail</apiUrl>
        <clientId>28282151647-7v4o64nevnu74o54k0g4fkn989rdccij.apps.googleusercontent.com</clientId>
        <clientSecret>SI29ttn6AzKxVkhOEyA8CIv4</clientSecret>
        <refreshToken>1/Xmbg2hWhOvOtGtU9U3ERp-Cv6UmUxakXu037fMcyip5LNf4EEsWX_iJ2sgNnz18c</refreshToken>
    </gmail.init>
    <gmail.sendMail>
        <to>{$ctx:email_id}</to>
        <subject>Payment Status</subject>
        <messageBody>{$ctx:payment_response}</messageBody>
    </gmail.sendMail>
    <drop/>
</sequence>
